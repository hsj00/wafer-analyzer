
# 🔬 웨이퍼 맵 분석기 — Cloud Edition

반도체 공정 데이터를 **웹 브라우저에서 즉시 분석**할 수 있는 Streamlit 앱입니다.

CSV 또는 Excel 파일을 업로드하면 **웨이퍼 맵 시각화 · 다중 파라미터 비교 · 결함 오버레이 · GPC 분석 · Excel 보고서 · ML 이상 탐지**를 한 화면에서 처리합니다.

> 🌐 **이 버전은 Streamlit Community Cloud에 바로 배포할 수 있도록 최적화되었습니다.**
>
> 로컬 파일시스템 대신 파일 업로드 방식으로 동작하며, 설치 없이 브라우저에서 사용할 수 있습니다.

---

## 목차

1. [이런 분께 필요합니다](https://claude.ai/chat/fad0d6d9-f8b3-4955-9add-6eb4c1f3c043#1-%EC%9D%B4%EB%9F%B0-%EB%B6%84%EA%BB%98-%ED%95%84%EC%9A%94%ED%95%A9%EB%8B%88%EB%8B%A4)
2. [30초 퀵스타트](https://claude.ai/chat/fad0d6d9-f8b3-4955-9add-6eb4c1f3c043#2-30%EC%B4%88-%ED%80%B5%EC%8A%A4%ED%83%80%ED%8A%B8)
3. [전체 기능 흐름](https://claude.ai/chat/fad0d6d9-f8b3-4955-9add-6eb4c1f3c043#3-%EC%A0%84%EC%B2%B4-%EA%B8%B0%EB%8A%A5-%ED%9D%90%EB%A6%84)
4. [프로젝트 구조](https://claude.ai/chat/fad0d6d9-f8b3-4955-9add-6eb4c1f3c043#4-%ED%94%84%EB%A1%9C%EC%A0%9D%ED%8A%B8-%EA%B5%AC%EC%A1%B0)
5. [설치 및 실행](https://claude.ai/chat/fad0d6d9-f8b3-4955-9add-6eb4c1f3c043#5-%EC%84%A4%EC%B9%98-%EB%B0%8F-%EC%8B%A4%ED%96%89)
6. [입력 데이터 형식](https://claude.ai/chat/fad0d6d9-f8b3-4955-9add-6eb4c1f3c043#6-%EC%9E%85%EB%A0%A5-%EB%8D%B0%EC%9D%B4%ED%84%B0-%ED%98%95%EC%8B%9D)
7. [화면 구성](https://claude.ai/chat/fad0d6d9-f8b3-4955-9add-6eb4c1f3c043#7-%ED%99%94%EB%A9%B4-%EA%B5%AC%EC%84%B1)
8. [탭별 사용 방법](https://claude.ai/chat/fad0d6d9-f8b3-4955-9add-6eb4c1f3c043#8-%ED%83%AD%EB%B3%84-%EC%82%AC%EC%9A%A9-%EB%B0%A9%EB%B2%95)
9. [사용 예시](https://claude.ai/chat/fad0d6d9-f8b3-4955-9add-6eb4c1f3c043#9-%EC%82%AC%EC%9A%A9-%EC%98%88%EC%8B%9C)
10. [자주 묻는 질문](https://claude.ai/chat/fad0d6d9-f8b3-4955-9add-6eb4c1f3c043#10-%EC%9E%90%EC%A3%BC-%EB%AC%BB%EB%8A%94-%EC%A7%88%EB%AC%B8)

---

## 1. 이런 분께 필요합니다

* 박막 두께, 식각 깊이, 면저항 등 **웨이퍼 전면 분포 데이터**를 시각화하고 싶은 공정 엔지니어
* ALD 공정의 **GPC(Growth Per Cycle)** 균일도를 분석하고 싶은 연구자
* 결함 검사 데이터를 공정 측정값과 **겹쳐서 보고 싶은** QC 담당자
* 여러 웨이퍼를 한꺼번에 비교하거나 **이상 웨이퍼를 자동으로 탐지**하고 싶은 엔지니어
* 분석 결과를 **Excel 보고서로 정리해서 공유**해야 하는 실무자

---

## 2. 30초 퀵스타트

처음 사용하시는 분은 아래 세 단계만 따라하세요.

```
1.  앱을 열면 왼쪽 사이드바가 보입니다.
2.  "🎯 샘플 5개 생성" 버튼을 클릭합니다.
     → 테스트용 가상 웨이퍼 데이터가 자동으로 만들어집니다.
3.  파일 목록에서 wafer_01.csv 를 선택합니다.
     → Heatmap, Contour, 3D Surface, 통계가 즉시 나타납니다!
```

> 💡 **샘플 데이터 없이 바로 시작하려면:** 사이드바의 파일 업로더에 자신의 CSV/Excel 파일을 드래그하세요.

---

## 3. 전체 기능 흐름

```
CSV / Excel 파일 업로드
       │
       ▼
① 📊 웨이퍼 맵   ←── 모든 탭의 시작점. 여기서 파일을 먼저 로드합니다.
       │
       ├──► ② 📐 다중 파라미터   같은 파일의 여러 컬럼을 나란히 Heatmap으로 비교
       │
       ├──► ③ 🔍 결함 오버레이   별도 결함 CSV를 웨이퍼 맵 위에 겹쳐 표시
       │
       ├──► ④ ⚗️ GPC 분석        두께 ÷ 사이클 수, 반경별 균일도 프로파일
       │
       ├──► ⑤ 📄 보고서 생성     통계 + 차트 이미지 + 원본 데이터 → xlsx 다운로드
       │
       └──► ⑥ 🤖 ML 이상 탐지   여러 웨이퍼를 PCA + IsolationForest로 자동 분류
```

> **탭 ②~⑤**는 탭 ①에서 데이터를 먼저 로드한 후 사용하세요.
>
> **탭 ⑥**은 독립된 데이터셋 패널이 있어 탭 안에서 직접 파일을 추가할 수 있습니다.

---

## 4. 프로젝트 구조

```
wafer_cloud/
│
├── .streamlit/
│   └── config.toml          # 앱 설정 (업로드 제한, 테마 색상)
│
├── app.py                   # 메인 앱 진입점 — 이 파일을 실행합니다
├── core.py                  # 공유 핵심 함수 (보간, 시각화, 통계)
├── requirements.txt         # Python 패키지 목록
│
└── modules/
    ├── __init__.py          # 모듈 안전 로드 관리
    ├── multi_param.py       # 탭 ② 다중 파라미터 서브플롯
    ├── defect_overlay.py    # 탭 ③ 결함 오버레이
    ├── gpc.py               # 탭 ④ GPC 분석
    ├── report.py            # 탭 ⑤ Excel 보고서 생성
    └── ml_anomaly.py        # 탭 ⑥ ML 기반 이상 탐지
```

> **⚠️ 주의:** `modules/` 폴더와 `core.py`가 모두 있어야 합니다.
> `app.py`만 단독으로 있으면 탭 ②~⑥이 전부 `⚠️` 상태로 비활성화됩니다.

---

## 5. 설치 및 실행

### 방법 A: Streamlit Community Cloud에 배포 (권장)

설치가 필요 없습니다. GitHub에 올리면 끝!

```
1.  이 프로젝트 폴더 전체를 GitHub 리포지토리에 push 합니다.
2.  https://share.streamlit.io 에 접속합니다.
3.  [New app] 버튼을 클릭합니다.
4.  리포지토리, 브랜치, 메인 파일 경로(app.py)를 선택합니다.
5.  [Deploy!] 를 클릭하면 몇 분 안에 배포가 완료됩니다.
6.  고유 URL이 생성되어 누구나 브라우저에서 접속할 수 있습니다.
```

### 방법 B: 내 컴퓨터에서 로컬 실행

**1단계 — Python 버전 확인** (3.10 이상 필요)

```bash
python --version
```

**2단계 — 가상환경 생성 (권장)**

```bash
python -m venv venv

# Windows
venv\Scripts\activate

# macOS / Linux
source venv/bin/activate
```

**3단계 — 패키지 설치**

```bash
pip install -r requirements.txt
```

**4단계 — 앱 실행**

```bash
streamlit run app.py
```

브라우저에서 `http://localhost:8501` 이 자동으로 열립니다.

### 패키지 목록

| 패키지       | 용도                                | 없으면                  |
| ------------ | ----------------------------------- | ----------------------- |
| streamlit    | 웹 UI 프레임워크                    | 앱 실행 불가            |
| pandas       | CSV/Excel 읽기 및 데이터 처리       | 앱 실행 불가            |
| numpy        | 수치 연산                           | 앱 실행 불가            |
| plotly       | 인터랙티브 차트                     | 앱 실행 불가            |
| scipy        | 웨이퍼 격자 보간                    | 앱 실행 불가            |
| openpyxl     | Excel 파일 읽기/쓰기                | 앱 실행 불가            |
| scikit-learn | ML 이상 탐지 (PCA, IsolationForest) | 🤖 ML 탭만 비활성화      |
| kaleido      | 차트 → PNG 변환 (보고서 이미지용)   | 이미지 없이 보고서 생성 |

> `scikit-learn`과 `kaleido`는 선택 패키지입니다. 없어도 나머지 탭은 정상 작동합니다.

---

## 6. 입력 데이터 형식

### 6-1. 기본 웨이퍼 맵 데이터 (CSV / Excel)

X·Y 좌표와 측정값 컬럼이 포함된 파일이면 됩니다.

| x     | y     | data  |
| ----- | ----- | ----- |
| 0.0   | 100.0 | 512.3 |
| -50.0 | 86.6  | 498.7 |
| -86.6 | 50.0  | 503.1 |

* **컬럼명 자동 인식:** `x`, `y`, `data` (대소문자 무관). 다른 이름이라도 사이드바 **🔗 컬럼 매핑**에서 직접 지정할 수 있습니다.
* **단위:** mm 기준. 200 mm 웨이퍼 → 반경 약 100 mm
* **최소 포인트 수:** 보간 품질을 위해 10개 이상 권장

### 6-2. GPC 분석용 데이터

두께 컬럼과 사이클 수 컬럼이 추가로 필요합니다.

| x     | y     | thickness_nm | n_cycles |
| ----- | ----- | ------------ | -------- |
| 0.0   | 100.0 | 51.2         | 100      |
| -50.0 | 86.6  | 49.8         | 100      |

* 모든 포인트의 사이클 수가 동일하다면 컬럼 없이 탭에서 숫자를 직접 입력해도 됩니다.

### 6-3. 결함 오버레이용 데이터 (별도 파일)

결함 오버레이 탭에서 별도로 업로드합니다.

| x     | y     | class    | size | description   |
| ----- | ----- | -------- | ---- | ------------- |
| 10.5  | -20.3 | Particle | 5.0  | 큰 입자       |
| -33.2 | 41.8  | Scratch  | 12.0 | 선형 스크래치 |

* **결함 분류 컬럼:** `class`, `type`, `category` 중 하나를 자동 인식합니다.
* **좌표 단위가 다른 경우:** 탭 내 단위 변환 옵션으로 보정합니다 (mm / μm / cm / inch).

---

## 7. 화면 구성

### 사이드바

앱 왼쪽 사이드바는 네 개 섹션으로 구성됩니다.

#### 📁 데이터 관리

| 항목            | 설명                                         |
| --------------- | -------------------------------------------- |
| 파일 업로드     | CSV/Excel 파일을 드래그 또는 클릭하여 업로드 |
| 🎯 샘플 5개 생성 | 테스트용 가상 웨이퍼 데이터 5개를 즉시 생성  |

> **여러 파일을 한 번에 업로드할 수 있습니다.** 비교 모드에서 활용하세요.

#### 🔀 분석 모드

단일 파일 분석 또는 여러 파일 나란히 비교 모드를 전환합니다.

#### ⚙️ 시각화 설정

| 항목            | 기본값  | 설명                                   |
| --------------- | ------- | -------------------------------------- |
| 컬러 스케일     | Rainbow | 차트 색상 테마                         |
| 해상도          | 100     | 보간 그리드 크기 (높을수록 선명, 느림) |
| Contour 단계 수 | 20      | 등고선 레벨 수                         |
| Line Scan 각도  | 0°      | 단면 프로파일 방향                     |

#### 🔗 컬럼 매핑

파일 로드 후 X축·Y축·측정값에 해당하는 컬럼을 지정합니다. 컬럼명이 `x`, `y`, `data`이면 자동 선택됩니다.

### 메인 화면 (탭)

단일 분석 모드에서는 상단에 6개 탭이 표시됩니다.

```
📊 웨이퍼 맵 │ 📐 다중 파라미터 │ 🔍 결함 오버레이 │ ⚗️ GPC 분석 │ 📄 보고서 생성 │ 🤖 ML 이상 탐지
```

---

## 8. 탭별 사용 방법

### 탭 ① — 📊 웨이퍼 맵

**모든 탭의 시작점**입니다. 파일을 업로드하면 차트와 통계가 자동 생성됩니다.

**제공 차트:** 2D Heatmap · Contour · Line Scan · 3D Surface

**통계:** Mean · Maximum · Minimum · Std Dev · Uniformity(%) · Range · 측정 포인트 수

**Raw Data 편집:** 하단 테이블에서 셀을 직접 수정하면 차트가 즉시 갱신됩니다. 수정한 데이터는 CSV로 다운로드할 수 있습니다.

---

### 탭 ② — 📐 다중 파라미터

같은 파일 안의 **여러 컬럼을 동시에 웨이퍼 맵으로 나란히 비교**합니다.

```
1. 탭 ①에서 데이터 파일을 로드합니다.
2. 📐 다중 파라미터 탭으로 이동합니다.
3. X·Y 컬럼을 지정하고 비교할 파라미터 컬럼을 2~6개 선택합니다.
4. 통일 스케일을 켜면 모든 맵의 색상 범위가 통일됩니다.
```

---

### 탭 ③ — 🔍 결함 오버레이

**웨이퍼 맵 위에 결함 좌표를 겹쳐** 공정 데이터와 결함의 공간적 상관관계를 분석합니다.

```
1. 탭 ①에서 웨이퍼 맵 데이터를 로드합니다.
2. 🔍 결함 오버레이 탭으로 이동합니다.
3. 결함 CSV/Excel 파일을 업로드합니다.
4. 표시할 결함 클래스를 선택합니다.
5. 좌표 단위가 다르면 단위 변환 옵션을 설정합니다.
```

---

### 탭 ④ — ⚗️ GPC 분석

ALD 공정의 **GPC(Growth Per Cycle)** 값을 계산하고 공간 분포를 분석합니다.

> **GPC = 두께(nm) ÷ 사이클 수**

```
1. 탭 ①에서 두께 데이터가 포함된 파일을 로드합니다.
2. ⚗️ GPC 탭으로 이동합니다.
3. 두께 컬럼과 사이클 모드를 선택합니다.
4. GPC Heatmap과 반경별 프로파일이 자동 생성됩니다.
```

**제공 결과:** GPC Heatmap · 반경별 GPC 프로파일 · Center / Mid / Edge 구역별 통계

---

### 탭 ⑤ — 📄 보고서 생성

분석 결과를 **Excel(.xlsx) 파일**로 내보냅니다.

| 시트       | 내용                                                   |
| ---------- | ------------------------------------------------------ |
| Summary    | 파일명, 생성 시각, 통계 요약                           |
| Statistics | 상세 통계 데이터                                       |
| Maps       | Heatmap · Contour · Line Scan · 3D Surface 차트 이미지 |
| Raw Data   | 원본 측정 데이터 (최대 5,000행)                        |
| GPC        | GPC 분석 결과 (GPC 탭 실행 후에만 포함됨)              |

> 차트 이미지 포함은 `kaleido` 패키지가 필요합니다. 없으면 이미지 없이 생성됩니다.

---

### 탭 ⑥ — 🤖 ML 이상 탐지

**PCA + IsolationForest**로 여러 웨이퍼 중 이상 패턴을 자동 탐지합니다. 최소 3개 이상의 웨이퍼 데이터가 필요합니다.

```
1. 🤖 ML 이상 탐지 탭으로 이동합니다.
2. 📋 분석 데이터셋 패널에서 웨이퍼 파일을 업로드하여 추가합니다.
3. 3개 이상 등록되면 파라미터를 설정합니다.
4. [🤖 이상 탐지 실행] 버튼을 클릭합니다.
```

**이상 패턴 분류**

| 패턴             | 특징               | 공정 원인 예시                       |
| ---------------- | ------------------ | ------------------------------------ |
| Ring             | 도넛형 방사 분포   | 가스 흐름 중심 집중 또는 확산 불균일 |
| Edge Degradation | 가장자리 두께 저하 | Edge exclusion, 로딩 효과            |
| X/Y-Gradient     | 방향성 두께 구배   | 기판 기울기, 가스 방향성             |
| Hotspot          | 국소 이상 피크     | 파티클, 스크래치, 측정 오류          |
| Global Shift     | 전체 수준 편차     | 레시피 변경, 공정 드리프트           |
| Normal           | 정상               | —                                    |

---

### 비교 모드 (Compare Mode)

사이드바 **🔀 분석 모드 → 비교 모드 활성화** 토글을 켜면 여러 웨이퍼를 나란히 비교합니다.

* **➕ 데이터셋 추가**에서 파일을 업로드하고 컬럼을 지정해 등록합니다.
* 같은 파일에서 Data 컬럼만 다르게 설정해 여러 파라미터를 비교할 수도 있습니다.
* **🔒 컬러 스케일 통일** 옵션으로 모든 카드의 색상 범위를 맞출 수 있습니다.

---

## 9. 사용 예시

### 예시 A: 처음 실행 — 샘플 데이터로 모든 기능 체험

```
1. 앱 접속 (Cloud URL 또는 localhost:8501)
2. 사이드바 → 🎯 샘플 5개 생성 클릭
3. 파일 목록에서 wafer_01.csv 선택
4. 탭 ① → Heatmap, Contour, 통계 확인
5. 탭 ② → 여러 컬럼 동시 비교 체험
6. 탭 ⑥ → 파일 업로드로 5개 웨이퍼 등록 → 이상 탐지 실행
```

### 예시 B: ALD 공정 GPC 분석

```
1. x, y, thickness_nm, n_cycles 컬럼이 있는 CSV 업로드
2. 사이드바 컬럼 매핑: X=x, Y=y, Data=thickness_nm
3. 탭 ④ → 두께 컬럼: thickness_nm / 모드: 컬럼 / 사이클 컬럼: n_cycles
4. GPC Heatmap 및 Center/Mid/Edge 통계 확인
5. 탭 ⑤ → GPC 포함 체크 → Excel 보고서 다운로드
```

### 예시 C: 결함 위치와 공정 데이터 상관 분석

```
1. 두께 측정 CSV + 결함 좌표 CSV 두 파일 준비
2. 탭 ① → 두께 CSV 업로드 → Heatmap 확인
3. 탭 ③ → 결함 CSV 업로드 → 클래스 선택 (예: Particle, Scratch)
4. 두께 낮은 영역과 결함 분포의 공간적 상관관계 분석
```

---

## 10. 자주 묻는 질문

| 질문                            | 답변                                                                           |
| ------------------------------- | ------------------------------------------------------------------------------ |
| 테스트할 데이터가 없어요        | 사이드바의**🎯 샘플 5개 생성**버튼을 클릭하세요                                 |
| 탭 이름 옆에 ⚠️가 있어요         | 해당 모듈 파일이 없거나 필요한 패키지가 미설치된 상태입니다                    |
| 🤖 ML 탭이 비활성화됩니다        | `scikit-learn`패키지가 필요합니다 (Cloud 배포 시 requirements.txt에 이미 포함) |
| 보고서에 차트 이미지가 없어요   | `kaleido`패키지가 필요합니다 (Cloud 배포 시 requirements.txt에 이미 포함)      |
| 결함 좌표 위치가 맞지 않아요    | 🔍 결함 오버레이 탭의**좌표 단위 변환**옵션을 설정하세요                        |
| 보간 실패 경고가 나타납니다     | 데이터 포인트가 너무 적거나 직선 위에 있을 때 발생합니다. 자동으로 대체됩니다  |
| 업로드 파일 크기 제한이 있나요? | 기본 200MB입니다.`.streamlit/config.toml`에서 조정할 수 있습니다               |
| Cloud에 배포했는데 오류가 나요  | `requirements.txt`와 `core.py`가 프로젝트 루트에 있는지 확인하세요             |

---

*Python 3.10+ · Streamlit 1.35+ 환경에서 검증됨*
